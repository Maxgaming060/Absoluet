"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),GuildModel_1=tslib_1.__importDefault(require("../../models/GuildModel")),Event_1=require("../../structures/Event"),types_1=require("util/types"),__1=require("../.."),ratingValues=["One","Two","Three","Four","Five"];exports.default=new Event_1.Event("guildTicketDeleted",((e,t)=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const i=yield e.send({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Support System").setDescription("Please use the menu below to select a rating that you give to our staff").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:generateComponents(!1)}).catch((()=>!1)).then((e=>e));if((0,types_1.isBooleanObject)(i))return;const s=yield i.awaitMessageComponent({filter:t=>t.user.id===e.id,componentType:discord_js_1.ComponentType.StringSelect}),o=s.values[0];yield s.reply({content:`<@!${e.id}> Thanks for the **${o} Star(s)** review.`,ephemeral:!0}),yield i.edit({components:generateComponents(!0)}),yield GuildModel_1.default.findOneAndUpdate({guildId:e.guild.id},{$push:{ticketReviews:{userId:e.id,staffId:t.staffClaimed,rating:o}}})}))));const generateComponents=(e=!1)=>[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.StringSelectMenuBuilder).setCustomId("ticket-review").setDisabled(e).setOptions(ratingValues.map(((e,t)=>({label:`${e} Star${0!==t?"s":""}`,value:`${t+1}`,emoji:"‚≠ê"})))))];