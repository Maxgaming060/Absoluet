"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),Event_1=require("../../structures/Event"),discord_js_1=require("discord.js"),__1=require("../.."),ms_1=tslib_1.__importDefault(require("ms"));exports.default=new Event_1.Event("interactionCreate",(e=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){if(e.isChatInputCommand()){e.member=e.guild.members.cache.get(e.user.id);const t=__1.client.commands.get(e.commandName),{Permissions:r,Cooldown:s}=__1.client.commandsConfig[t.permission];if(!e.member.roles.cache.some((e=>r.includes(e.id)||r.includes(e.name)))&&!r.includes(e.member.id))return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("You don't have permissions to execute this command").setColor("Red")]});try{const r=`${e.user.id}-${t.name}`,i=__1.client.cooldowns.get(r)||0,o=s?(0,ms_1.default)(s):0;if(i-Date.now()>0)return e.reply({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds.UserInCooldownEmbed,{"{user-tag}":e.user.tag,"{user-avatar}":e.user.displayAvatarURL(),"{time}":`${Math.floor(i/1e3)}`})]});yield t.run({client:__1.client,interaction:e}),o>0&&(__1.client.cooldowns.set(r,Date.now()+o),setTimeout((()=>{__1.client.cooldowns.delete(r)}),o))}catch(t){if("exclude"===(null==t?void 0:t.message))return;console.error(t),e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("An error occurred. Don't panic.").setDescription("This means that something unexpected occurred while processing your request. Don't panic, we throw errors more than you throw parties because it helps us catch more bugs. It's harder to get chicks without throwing parties, right?").setColor("Red")]}).catch((e=>e))}}}))));
