"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),VoiceChannelModel_1=tslib_1.__importDefault(require("../../models/VoiceChannelModel")),Event_1=require("../../structures/Event"),__1=require("../..");function lockChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield e.permissionOverwrites.edit(n.guildId,{ViewChannel:!0,Connect:!1}),yield e.edit({name:`Locked | ${i.user.username}'s VC`}),yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Your voice channel has been locked from everyone!").setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0})}))}function unLockChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield e.permissionOverwrites.edit(n.guildId,{Connect:!0}),yield e.edit({name:`${i.user.username}'s VC`}),yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Your voice channel has been unlocked from everyone!").setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0})}))}function hideChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield e.permissionOverwrites.edit(n.guildId,{ViewChannel:!1}),yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Your voice channel has been hidden from everyone!").setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0})}))}function unHideChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield e.permissionOverwrites.edit(n.guildId,{ViewChannel:!0}),yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Your voice channel has been hidden from everyone!").setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0})}))}function setLimitUsersChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const i=Date.now();yield n.showModal((new discord_js_1.ModalBuilder).setTitle("Voice channel editor").setCustomId(`${i}-vcm>limit`).setComponents((new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.TextInputBuilder).setLabel("Voice Channel Limit").setStyle(discord_js_1.TextInputStyle.Short).setCustomId("limit").setPlaceholder("4").setMinLength(1).setMaxLength(2))));const t=yield n.awaitModalSubmit({filter:e=>e.customId===`${i}-vcm>limit`&&e.user.id===n.user.id,time:12e4});if(!t)return;const o=parseInt(t.fields.getTextInputValue("limit"));return isNaN(o)||o>99||o<0?t.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Provide a user limit between 0 and 99.").setColor("Red")],ephemeral:!0}):(yield e.edit({userLimit:o}),t.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle(`The user limit of your VC has been set to ${o} users.`).setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0}))}))}function renameChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const i=Date.now();yield n.showModal((new discord_js_1.ModalBuilder).setTitle("Voice channel editor").setCustomId(`${i}-vcm>name`).setComponents((new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.TextInputBuilder).setPlaceholder("Playing Valorant").setLabel("Voice Channel Name").setStyle(discord_js_1.TextInputStyle.Short).setCustomId("name").setMaxLength(25).setMinLength(1))));const t=yield n.awaitModalSubmit({filter:e=>e.customId===`${i}-vcm>name`&&e.user.id===n.user.id,time:12e4});if(!t)return;const o=t.fields.getTextInputValue("name");return yield e.edit({name:o}),t.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle(`The name of your voice channel has been updated to ${o}.`).setColor(__1.client.config.GeneralSettings.EmbedColor)],ephemeral:!0})}))}function inviteUserToChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const t=yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Selection required").setDescription("Select the users you wanna invite in your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.UserSelectMenuBuilder).setPlaceholder("Select the users to invite").setCustomId("vcm>users").setMinValues(1).setMaxValues(10))],ephemeral:!0}),o=yield t.awaitMessageComponent({componentType:discord_js_1.ComponentType.UserSelect,filter:e=>e.user.id===n.user.id}),s=o.values;for(const i of s)yield e.permissionOverwrites.edit(i,{ViewChannel:!0,Connect:!0});return yield e.send({content:s.map((e=>`<@!${e}>`)).join(", "),embeds:[(new discord_js_1.EmbedBuilder).setTitle("Invitation received").setDescription(`<@!${i.id}> has invited you to join this voice channel!`).setColor(__1.client.config.GeneralSettings.EmbedColor)]}).catch((e=>e)),yield o.deferUpdate(),o.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Users invited to your voice channel successfully!").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[]})}))}function kickUserFromChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const i=e.members.map((e=>e.user)),t=yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Selection required").setDescription("Select the user that you want to kick from your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.StringSelectMenuBuilder).setPlaceholder("Select the user to kick").setCustomId("vcm>users").setOptions(i.map((e=>({emoji:"<:user:1029823616113713263>",label:e.username,value:e.id})))))],ephemeral:!0}),o=yield t.awaitMessageComponent({componentType:discord_js_1.ComponentType.StringSelect,filter:e=>e.user.id===n.user.id}),s=n.guild.members.cache.get(o.values[0]);return o.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle(`${s.user.username} has been kicked from your voice channel.`).setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[]})}))}function banMentionablesFromChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const i=yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Selection required").setDescription("Select the roles / users to ban from your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.MentionableSelectMenuBuilder).setPlaceholder("Select the roles or users to ban").setCustomId("vcm>users").setMaxValues(10).setMinValues(1))],ephemeral:!0}),t=yield i.awaitMessageComponent({componentType:discord_js_1.ComponentType.StringSelect,filter:e=>e.user.id===n.user.id});for(const i of t.values)yield e.permissionOverwrites.edit(i,{Connect:!1});return t.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("The users / roles you provided have been banned from joining your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[]})}))}function permitMentionablesFromChannel(e,i,n){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const i=yield n.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Selection required").setDescription("Select the roles / users to permit in your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.MentionableSelectMenuBuilder).setPlaceholder("Select the roles or users to permit").setCustomId("vcm>users").setMaxValues(10).setMinValues(1))],ephemeral:!0}),t=yield i.awaitMessageComponent({componentType:discord_js_1.ComponentType.StringSelect,filter:e=>e.user.id===n.user.id});for(const i of t.values)yield e.permissionOverwrites.edit(i,{Connect:!0,ViewChannel:!0});return t.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("The users / roles you provided are now permitted to join your voice channel.").setColor(__1.client.config.GeneralSettings.EmbedColor)],components:[]})}))}exports.default=new Event_1.Event("interactionCreate",(e=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var i;if(!e.isButton())return;if(!e.customId.startsWith("vc>"))return;const n=yield e.guild.members.fetch(e.user.id),t=null===(i=n.voice)||void 0===i?void 0:i.channel;if(!(yield VoiceChannelModel_1.default.findOne({guildId:e.guildId,channelId:null==t?void 0:t.id,ownerId:n.id})))return yield e.deferUpdate();const o=e.customId.split("vc>")[1];"lock"===o&&lockChannel(t,n,e),"unlock"===o&&unLockChannel(t,n,e),"hide"===o&&hideChannel(t,n,e),"unhide"===o&&unHideChannel(t,n,e),"limit"===o&&setLimitUsersChannel(t,n,e),"rename"===o&&renameChannel(t,n,e),"invite"===o&&inviteUserToChannel(t,n,e),"kick"===o&&kickUserFromChannel(t,n,e),"ban"===o&&banMentionablesFromChannel(t,n,e),"permit"===o&&permitMentionablesFromChannel(t,n,e)}))));