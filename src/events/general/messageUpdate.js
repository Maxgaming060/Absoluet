"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),Event_1=require("../../structures/Event"),querys_1=require("../../helpers/querys"),__1=require("../..");exports.default=new Event_1.Event("messageUpdate",((e,t)=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){if(!e.content&&!t.content)return;if(e.content===t.content)return;const s=yield(0,querys_1.guilds)().get(e.guildId);if(s.filtersConfig.ghostPing){if(e.channel.type===discord_js_1.ChannelType.DM||e.author.bot)return;if(e.member.roles.cache.some((e=>s.filtersConfig.bypassRoles.includes(e.id))))return;const n=e.mentions.users.filter((e=>!t.mentions.users.has(e.id)));n.size>=1&&(yield e.channel.send({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds.GhostPingDetectedEmbed,{"{author-tag}":e.author.tag,"{author-username}":e.author.username,"{mentioned-username}":`${n.first().username}`,"{mentioned-tag}":`${n.first().tag}`})]}))}const n=t.guild.channels.cache.get(null==s?void 0:s.logChannel);n&&(yield n.send({embeds:[(0,replaceAll_1.default)(__1.client.messages.Logs.MessageUpdated,{"{author}":t.author.toString(),"{author-tag}":t.author.tag,"{channel}":t.channel.toString(),"{message-url}":t.url,"{old-message}":e.cleanContent.slice(0,1018),"{new-message}":t.cleanContent.slice(0,1018)})]}))}))));