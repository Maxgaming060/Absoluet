"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),SuggestModel_1=tslib_1.__importDefault(require("../../models/SuggestModel")),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),Event_1=require("../../structures/Event"),querys_1=require("../../helpers/querys"),__1=require("../..");exports.default=new Event_1.Event("interactionCreate",(e=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var t,s;if(!e.isButton())return;if(!e.customId.startsWith("sgt"))return;const[,i,u]=e.customId.split("-"),o=yield SuggestModel_1.default.findOne({guildId:e.guildId,suggestionId:u}),d=yield(0,querys_1.guilds)().get(e.guildId);if(!o)return;if(yield e.deferUpdate(),"upvote"===i){if(o.upvotes.includes(e.user.id))return;if(o.downvotes.includes(e.user.id))return;o.upvotes.push(e.user.id)}else if("downvote"===i){if(o.downvotes.includes(e.user.id))return;if(o.upvotes.includes(e.user.id))return;o.downvotes.push(e.user.id)}else"reset"===i&&(o.upvotes.includes(e.user.id)&&o.upvotes.splice(o.upvotes.indexOf(e.user.id),1),o.downvotes.includes(e.user.id)&&o.downvotes.splice(o.downvotes.indexOf(e.user.id),1));yield o.save();const n=__1.client.users.cache.get(null==o?void 0:o.ownerId),l=__1.client.users.cache.get(null==o?void 0:o.staffUsername);e.message.edit({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds[`Suggest${o.status}Embed`],{"{updated-date}":(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),"{suggestion}":o.suggestion,"{upvote-emoji}":(null===(t=null==d?void 0:d.suggestionConfig)||void 0===t?void 0:t.upvote)||"üëç","{downvote-emoji}":(null===(s=null==d?void 0:d.suggestionConfig)||void 0===s?void 0:s.downvote)||"üëé","{upvote-count}":o.upvotes.length,"{downvote-count}":o.downvotes.length,"{user-tag}":null==n?void 0:n.tag,"{user-pfp}":n.displayAvatarURL(),"{message-id}":u,"{response}":null==o?void 0:o.staffResponse,"{staff-username}":null==l?void 0:l.username,"{staff-tag}":null==l?void 0:l.tag,"{staff}":null==l?void 0:l.toString()})]})}))));