"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),InvitesModel_1=tslib_1.__importDefault(require("../../models/InvitesModel")),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),UserModel_1=tslib_1.__importDefault(require("../../models/UserModel")),__1=require("../..");__1.client.giveawayManager.on("giveawayReactionAdded",((e,i,l)=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var s;const{extraData:t}=e,{levels:r,invites:d,messages:n}=t.requirements,a={levels:""===r,invites:""===d,messages:""===n},o=yield UserModel_1.default.findOne({guildId:i.guild.id,ownerId:i.id});if(""!==r&&(null==o?void 0:o.level)>=parseInt(r)&&(a.levels=!0),""!==n&&(null==o?void 0:o.messages)>=parseInt(n)&&(a.messages=!0),""!==d){const e=yield InvitesModel_1.default.findOne({guildId:i.guild.id,userId:i.id});(null===(s=null==e?void 0:e.invites)||void 0===s?void 0:s.length)+(null==e?void 0:e.bonus)>=parseInt(d)&&(a.invites=!0)}if(!((null==a?void 0:a.levels)&&(null==a?void 0:a.messages)&&(null==a?void 0:a.invites))){const s=e=>e.charAt(0).toUpperCase()+e.slice(1),r=Object.entries(a).filter((e=>!e[1])).map((e=>`ãƒ» **${s(e[0])}**: ${t.requirements[e[0]]}`)).join("\n");return yield l.users.remove(i.user),i.send({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds.GiveawayNoRequirements,{"{prize}":e.prize,"{giveaway-url}":e.messageURL,"{formattedRequirements}":r})]})}}))));