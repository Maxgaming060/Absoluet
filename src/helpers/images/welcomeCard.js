"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),canvas_1=tslib_1.__importDefault(require("@napi-rs/canvas")),replaceAll_1=tslib_1.__importDefault(require("../replaceAll")),__1=require("../.."),jimp_1=tslib_1.__importDefault(require("jimp"));let backgroundImageCache=null;const{WelcomeCardBackground:WelcomeCardBackground,WelcomeCard1stLine:WelcomeCard1stLine,WelcomeCard2ndLine:WelcomeCard2ndLine,WelcomeCard3rdLine:WelcomeCard3rdLine}=__1.client.messages.Strings;function welcomeCard(e){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const a=canvas_1.default.createCanvas(1024,500),t=a.getContext("2d"),r=yield getBackgroundImage();t.drawImage(r,0,0,a.width,a.height);const i=yield jimp_1.default.read(e.displayAvatarURL({extension:"jpg"}));i.circle();const l=yield canvas_1.default.loadImage(yield i.getBufferAsync("image/png"));t.drawImage(l,393,47,238,238),t.lineWidth=10,t.strokeStyle="#FFFFFF",t.beginPath(),t.arc(512,166,124,0,2*Math.PI),t.closePath(),t.stroke();const n={"{user-discriminator}":e.user.discriminator,"{memberCount}":e.guild.memberCount,"{user-name}":e.user.username,"{user-tag}":e.user.username,"{guild-name}":e.guild.name};writeText(t,(0,replaceAll_1.default)(WelcomeCard1stLine,n),360,69),writeText(t,(0,replaceAll_1.default)(WelcomeCard2ndLine,n),410,41),writeText(t,(0,replaceAll_1.default)(WelcomeCard3rdLine,n),455,30);return yield a.encode("png")}))}function writeText(e,a,t,r){e.font=`${r}px CustomFont`,e.fillStyle="#FFFFFF";const i=e.measureText(a).width;e.fillText(a,(e.canvas.width-i)/2,t)}function getBackgroundImage(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return backgroundImageCache||(backgroundImageCache=yield canvas_1.default.loadImage(WelcomeCardBackground)),backgroundImageCache}))}exports.default=welcomeCard;