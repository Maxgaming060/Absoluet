"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_giveaways_1=require("discord-giveaways"),discord_js_1=require("discord.js"),GiveawayModel_1=tslib_1.__importDefault(require("../models/GiveawayModel")),replaceAll_1=tslib_1.__importDefault(require("../helpers/replaceAll"));class ExtendedGiveawaysManager extends discord_giveaways_1.GiveawaysManager{generateMainEmbed(e){const a=Object.values(e.extraData.requirements).some((e=>""!==e)),{GiveawayEmbed:t,GiveawayWithRequirements:i}=this.client.messages.Embeds,r=(0,replaceAll_1.default)(a?i:t,{"{description}":e.extraData.description||"","{timestamp}":Math.round(e.endAt/1e3),"{prize}":e.prize,"{winners}":e.winnerCount,"{user-tag}":e.hostedBy.tag,"{user}":e.hostedBy.toString(),"{image}":e.extraData.image,"{requirements}":Object.entries(e.extraData.requirements).filter((e=>e[1])).map((e=>`> You must be at ${e[0]} ${e[1]||5} or higher`)).join("\n")});return e.extraData.image||delete r.image,new discord_js_1.EmbedBuilder(r)}generateEndEmbed(e,a){const t=a.map((e=>`${e}`)).join("\n"),i=(0,replaceAll_1.default)(this.client.messages.Embeds.GiveawayEndEmbed,{"{description}":e.extraData.description||"","{timestamp}":Math.round(e.endAt/1e3),"{prize}":e.prize,"{user}":e.hostedBy,"{winners}":t||"None.","{image}":e.extraData.image});return e.extraData.image||delete i.image,new discord_js_1.EmbedBuilder(i)}generateNoValidParticipantsEndEmbed(e){const a=(0,replaceAll_1.default)(this.client.messages.Embeds.GiveawayEndEmbed,{"{description}":e.extraData.description||"","{timestamp}":Math.round(e.endAt/1e3),"{prize}":e.prize,"{user}":e.hostedBy,"{winners}":"None.","{image}":e.extraData.image});return e.extraData.image||delete a.image,new discord_js_1.EmbedBuilder(a)}getAllGiveaways(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield GiveawayModel_1.default.find().lean()}))}saveGiveaway(e,a){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield GiveawayModel_1.default.create(a),!0}))}editGiveaway(e,a){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield GiveawayModel_1.default.updateOne({messageId:e},a),!0}))}deleteGiveaway(e){return tslib_1.__awaiter(this,void 0,void 0,(function*(){return yield GiveawayModel_1.default.deleteOne({messageId:e}),!0}))}}exports.default=ExtendedGiveawaysManager;