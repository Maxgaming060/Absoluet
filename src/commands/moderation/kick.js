"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),pagination_1=tslib_1.__importDefault(require("../../helpers/pagination")),Command_1=require("../../structures/Command"),discord_js_1=require("discord.js"),PunishModel_1=tslib_1.__importDefault(require("../../models/PunishModel"));module.exports=new Command_1.Command({name:"kick",description:"Kicks manager",options:[{name:"add",description:"Kick a member from the server",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"member",description:"The member to kick",type:discord_js_1.ApplicationCommandOptionType.User,required:!0},{name:"reason",description:"The reason for the kick",type:discord_js_1.ApplicationCommandOptionType.String,required:!0}]},{name:"remove",description:"Remove a kick from a member",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"case",description:"The case to remove",type:discord_js_1.ApplicationCommandOptionType.Integer,required:!0},{name:"reason",description:"The reason for the kick removal",type:discord_js_1.ApplicationCommandOptionType.String,required:!0}]},{name:"list",description:"Lists all kicks for a member or all members",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"member",description:"The member to list kicks for",type:discord_js_1.ApplicationCommandOptionType.User}]}],run:({client:e,interaction:i})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var o,s,d,t,r,n;const l=i.options.getString("reason"),a=i.options.getMember("member"),m=yield PunishModel_1.default.findOne({guildId:i.guildId}),c=(null==m?void 0:m.kicks)||[],u=i.options.getSubcommand(!1);if("add"===u){if(!i.memberPermissions.has("KickMembers"))return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("You can't use this command, beacuse you don't have permissions").setColor("Red")]});if(a.id===e.user.id)return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Hey, you can't kick me, what will you do without me?").setColor("Red")]});if(a&&i.member.roles.highest.position<=a.roles.highest.position)return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("You can't use this command, beacuse you don't have permissions").setColor("Red")]});if(a&&!a.kickable)return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("You can't use this command, beacuse you don't have permissions").setColor("Red")]});const o=(null==m?void 0:m.cases)+1||1,s=e=>({userId:a.id,reason:l,date:new Date,staff:i.member.id,caseNumber:e,removeReason:null});if(m){const e=[...c,s(o)];yield PunishModel_1.default.updateOne({guildId:i.guildId},{$set:{kicks:e,cases:o}})}else yield PunishModel_1.default.create({guildId:i.guildId,kicks:[s(1)],cases:1});yield a.kick(l).then((()=>{i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Successfully kicked").setDescription(`âœ… \`Case #${o}\` ${a} has been kicked for \`${l}\``).setColor(e.config.GeneralSettings.EmbedColor)]})})).catch((e=>{i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Failed to kick").setDescription(`ðŸ“• ${e.message}`).setColor("Red")]})}))}if("remove"===u){const o=i.options.getInteger("case"),s=c.find((e=>e.caseNumber===o));if(!s)return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Failed to kick").setDescription(`ðŸ“• \`Case #${o}\` does not exist or has already been removed`).setColor("Red")]});const d=c.map((e=>((null==e?void 0:e.caseNumber)===o&&(e.removeReason=l),e)));return yield PunishModel_1.default.updateOne({guildId:i.guildId},{$set:{kicks:d}}),i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Successfully removed kick").setDescription(`âœ… \`Case #${o}\` <@!${s.userId}> has been removed for \`${l}\``).setColor(e.config.GeneralSettings.EmbedColor)]})}if("list"===u){const l=(null==a?void 0:a.id)?c.filter((e=>(null==e?void 0:e.userId)===a.id)):c;if(!l.length)return i.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("No kick's found").setDescription(`ðŸ“• \`${(null==a?void 0:a.id)?a.user.tag:"All members"}\` have no kick's`).setColor("Red")]});const m=[];for(let c=0;c<l.length;c++){const u=l[c],p=(new discord_js_1.EmbedBuilder).setTitle(`Kick's for ${(null===(o=null==a?void 0:a.user)||void 0===o?void 0:o.tag)||i.guild.name}`).setDescription(`**ðŸ¦µ Case #${u.caseNumber}${u.removeReason?"** __**[Removed]**__":"**"}`).addFields({name:"ðŸ“¦ | Case",value:`Number: ${u.caseNumber}`,inline:!0},{name:"ðŸ‘¥ | User",value:null!==(d=null===(s=i.guild.members.cache.get(u.userId))||void 0===s?void 0:s.user.tag)&&void 0!==d?d:`<@!${u.userId}>`,inline:!0},{name:"ðŸ“† | Date",value:`<t:${Math.floor(u.date.getTime()/1e3)}> (<t:${Math.floor(u.date.getTime()/1e3)}:R>)`,inline:!0},{name:"ðŸ“ƒ | Reason",value:u.reason,inline:!0},{name:"ðŸ‘® | Moderator",value:null!==(r=null===(t=i.guild.members.cache.get(u.moderator))||void 0===t?void 0:t.user.tag)&&void 0!==r?r:`<@!${u.moderator}>`,inline:!0}).setColor(e.config.GeneralSettings.EmbedColor).setFooter({text:`Page ${c+1} of ${l.length} - ${i.guild.name}`,iconURL:e.user.displayAvatarURL()});u.removeReason&&p.addFields({name:"ðŸ”‘ | Removed",value:null!==(n=u.removeReason)&&void 0!==n?n:"No reason",inline:!0}),m.push(p)}(0,pagination_1.default)({interaction:i,embeds:m,time:12e4})}}))});