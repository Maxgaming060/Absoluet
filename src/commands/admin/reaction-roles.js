"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),pagination_1=tslib_1.__importDefault(require("../../helpers/pagination")),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),querys_1=require("../../helpers/querys"),styles={1:"Primary",2:"Secondary",3:"Success",4:"Danger"};exports.default=new Command_1.Command({name:"reaction-roles",description:"Manage the reaction-roles system",options:[{name:"add",description:"Add a role to the panel",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"category",description:"The category to which the role will be added ex: countries, notifications",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"role",description:"The role to add",type:discord_js_1.ApplicationCommandOptionType.Role,required:!0},{name:"emoji",description:"The emoji of the reaction role.",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"label",description:"The label of the reaction role.",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"style",description:"The style of the button.",type:discord_js_1.ApplicationCommandOptionType.String,choices:[{name:"Primary",value:"1"},{name:"Danger",value:"4"},{name:"Success",value:"3"},{name:"Secondary",value:"2"}],required:!0}]},{name:"list",description:"List all the reaction panels",type:discord_js_1.ApplicationCommandOptionType.Subcommand},{name:"send",description:"Send a reaction panel.",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"category",description:"The category to send in the channel",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"title",description:"The title of the embed",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"description",description:"The description of the embed",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"channel",description:"The channel to send the reaction panel to.",type:discord_js_1.ApplicationCommandOptionType.Channel,channelTypes:[discord_js_1.ChannelType.GuildText]},{name:"display-label",description:"Show the name will be displayed on the button",type:discord_js_1.ApplicationCommandOptionType.Boolean}]},{name:"delete",description:"Delete a reaction panel",type:discord_js_1.ApplicationCommandOptionType.Subcommand,options:[{name:"role",description:"The panel role of the panel to delete",type:discord_js_1.ApplicationCommandOptionType.Role,required:!0}]}],run:({interaction:e,client:o})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var t,i,n;const l=e.options.getString("category"),s=e.options.getSubcommand();if("add"===s){const t=e.options.getRole("role"),i=e.options.getString("emoji"),n=e.options.getString("label"),s=parseInt(e.options.getString("style"))||1,d={role:t,emoji:i,label:n,style:s,category:l},r=yield(0,querys_1.guilds)().get(e.guildId);return yield r.updateOne({$set:{rolesConfig:[...r.rolesConfig,d]}}),e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Reaction Panel Added").setColor(o.config.GeneralSettings.EmbedColor).addFields({name:"• Panel Information:",value:`>>> Role: **${t.name}**\nEmoji: ${i}\nLabel: **${n}**\nStyle: **${styles[s]}**`}).setTimestamp()]})}if("delete"===s){const i=e.options.getRole("role"),n=yield(0,querys_1.guilds)().get(e.guildId);if(!(null===(t=null==n?void 0:n.rolesConfig)||void 0===t?void 0:t.length))return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("This guild does not have a reaction role panel.").setColor("Red")]});return n.rolesConfig.find((e=>e.role===i.id))?(yield n.updateOne({$pull:{rolesConfig:{role:i.id}}}),e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle(`The ${i.name} has been deleted from the reaction-roles`).setColor(o.config.GeneralSettings.EmbedColor)]})):e.followUp({embeds:[(new discord_js_1.EmbedBuilder).setTitle("This reaction-role doesn't exists").setColor("Red")]})}if("list"===s){const t=yield(0,querys_1.guilds)().get(e.guildId);if(!(null===(i=null==t?void 0:t.rolesConfig)||void 0===i?void 0:i.length))return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("This guild does not have a reaction role panel.").setColor("Red")]});const n=[];for(const e of t.rolesConfig)n.push((new discord_js_1.EmbedBuilder).setAuthor({name:`Total Roles Panels ${t.rolesConfig.length}`,iconURL:o.user.displayAvatarURL()}).setColor(o.config.GeneralSettings.EmbedColor).addFields({name:"• Panel Information:",value:`>>> Role: <@&${e.role}>\nCategory: **${e.category}**\nLabel: **${e.label}**\nStyle: **${styles[e.style]}**\nEmoji: ${e.emoji}`}).setTimestamp().setFooter({text:`Page ${n.length+1} of ${t.rolesConfig.length}`}));return(0,pagination_1.default)({interaction:e,embeds:n,time:6e4})}if("send"===s){const t=e.options.getChannel("channel")||e.channel,i=e.options.getBoolean("display-label"),s=e.options.getString("description"),d=e.options.getString("title");yield e.deferReply({ephemeral:!0});const r=yield(0,querys_1.guilds)().get(e.guildId);if(!(null===(n=null==r?void 0:r.rolesConfig)||void 0===n?void 0:n.length))return e.followUp({embeds:[(new discord_js_1.EmbedBuilder).setTitle("This guild does not have a reaction role panel.").setColor("Red")]});const a=[];let p=new discord_js_1.ActionRowBuilder;const c=r.rolesConfig.filter((e=>e.category===l));for(const e of c){const o=(new discord_js_1.ButtonBuilder).setCustomId(`rct-${e.role}`).setStyle(e.style).setEmoji(e.emoji);i&&o.setLabel(e.label),p.addComponents(o),5===p.components.length&&(a.push(p),p=new discord_js_1.ActionRowBuilder)}p.components.length>0&&a.push(p);const m=(0,replaceAll_1.default)(o.messages.Embeds.SelectReactionRoleEmbed,{"{panels}":c.map((e=>(0,replaceAll_1.default)(o.messages.Embeds.SelectReactionRoleEmbed.panelsFormat,{"{emoji}":e.emoji,"{name}":e.label,"{role}":`<@&${e.role}>`}))).join("\n"),"{title}":d,"{description}":s});yield t.send({embeds:[m],components:a}),yield e.followUp({embeds:[(new discord_js_1.EmbedBuilder).setTitle("The reaction roles panel has been sent to the channel").setColor(o.config.GeneralSettings.EmbedColor)]})}}))});