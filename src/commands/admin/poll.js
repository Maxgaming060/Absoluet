"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),querys_1=require("../../helpers/querys"),emojis=["1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣","🔟"];function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}exports.default=new Command_1.Command({name:"poll",description:"Send a poll message to a channel",options:[{name:"title",description:"Title of the poll",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"description",description:"Description of the poll",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"type",description:"Type of the poll",type:discord_js_1.ApplicationCommandOptionType.String,choices:[{name:"Single",value:"single"},{name:"Multiple",value:"multiple"}],required:!0},{name:"choice1",description:"Choice 1",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"choice2",description:"Choice 2",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"choice3",description:"Choice 3",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice4",description:"Choice 4",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice5",description:"Choice 5",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice6",description:"Choice 6",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice7",description:"Choice 7",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice8",description:"Choice 8",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice9",description:"Choice 9",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"choice10",description:"Choice 10",type:discord_js_1.ApplicationCommandOptionType.String,required:!1},{name:"channel",description:"Channel to send the poll",type:discord_js_1.ApplicationCommandOptionType.Channel,channelTypes:[discord_js_1.ChannelType.GuildText],required:!1}],run:({client:e,interaction:i})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const o=i.options.getChannel("channel")||i.channel,t=i.options.getString("description"),n=i.options.getString("type"),r=i.options.getString("title"),p=[i.options.getString("choice1"),i.options.getString("choice2"),i.options.getString("choice3"),i.options.getString("choice4"),i.options.getString("choice5"),i.options.getString("choice6"),i.options.getString("choice7"),i.options.getString("choice8"),i.options.getString("choice9"),i.options.getString("choice10")],c=p.filter((e=>null!==e)).map(((i,o)=>(0,replaceAll_1.default)(e.messages.Embeds.PollEmbed.choicesFormat,{"{emoji}":emojis[o],"{choice}":i,"{percentage}":"0","{votes}":"0"}))),s=yield o.send({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.PollEmbed,{"{title}":r,"{description}":t,"{choices}":c.join(""),"{author-username}":i.user.username,"{author-pfp}":i.user.displayAvatarURL(),"{author-tag}":i.user.tag,"{timestamp}":(new Date).toISOString(),"{votes-total}":0,"{mode}":capitalize(n)})]});c.forEach(((e,i)=>s.react(emojis[i]))),yield(0,querys_1.polls)().create({messageId:s.id,channelId:s.channelId,guildId:s.guildId,title:r,description:t,choices:p.filter((e=>null!==e)),authorId:i.user.id,pollType:n,voters:[]}),yield i.reply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.PollSentEmbed)],ephemeral:!0})}))});