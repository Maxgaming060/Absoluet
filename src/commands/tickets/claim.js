"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),parseStyle_1=tslib_1.__importDefault(require("../../helpers/parseStyle")),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),TicketModel_1=tslib_1.__importDefault(require("../../models/TicketModel")),Command_1=require("../../structures/Command");exports.default=new Command_1.Command({name:"claim",description:"Claim a ticket",run:({client:e,interaction:s})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var t;if(s.channel.type!==discord_js_1.ChannelType.GuildText)return;const i=yield TicketModel_1.default.findOne({guildId:s.guildId,channelId:s.channelId});if(!i)return s.reply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.ChannelIsNotATicketEmbed)]});if(i.isClaimed)return s.reply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.TicketAlreadyClaimed,{"{user-tag}":(null===(t=e.users.cache.get(i.staffClaimed))||void 0===t?void 0:t.tag)||"Unknown#000"})]});yield s.channel.permissionOverwrites.edit(s.user.id,{ViewChannel:!0,ManageChannels:!0});for(const e of i.staffRoles)yield s.channel.permissionOverwrites.edit(e,{ViewChannel:!1}).catch((e=>e));return i.isClaimed=!0,i.staffClaimed=s.user.id,yield i.save(),(yield s.channel.messages.fetchPinned()).first().edit({components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.ButtonBuilder).setEmoji(e.messages.Buttons.TicketClose.Emoji).setLabel(e.messages.Buttons.TicketClose.Label).setStyle((0,parseStyle_1.default)(e.messages.Buttons.TicketClose.Style)).setCustomId("tka-close").setDisabled(i.isClosed),(new discord_js_1.ButtonBuilder).setEmoji(e.messages.Buttons.TicketClaim.Emoji).setLabel(e.messages.Buttons.TicketClaim.Label).setStyle((0,parseStyle_1.default)(e.messages.Buttons.TicketClaim.Style)).setCustomId("tka-claim").setDisabled(i.isClaimed))]}),s.reply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.TicketClaimedEmbed,{"{user}":s.user.toString(),"{user-id}":s.user.id,"{user-tag}":s.user.tag})]})}))});