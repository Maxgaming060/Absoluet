"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),querys_1=require("../../helpers/querys"),pagination_1=tslib_1.__importDefault(require("../../helpers/pagination")),InvitesModel_1=tslib_1.__importDefault(require("../../models/InvitesModel")),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),ms_1=tslib_1.__importDefault(require("ms"));exports.default=new Command_1.Command({name:"leaderboard",description:"Check the leaderboard of the server",options:[{name:"messages",description:"Check the messages leaderboard.",type:discord_js_1.ApplicationCommandOptionType.Subcommand},{name:"invites",description:"Check the invites leaderboard",type:discord_js_1.ApplicationCommandOptionType.Subcommand},{name:"levels",description:"Check the levels leaderboard",type:discord_js_1.ApplicationCommandOptionType.Subcommand},{name:"economy",description:"Check the economy leaderboard",type:discord_js_1.ApplicationCommandOptionType.Subcommand},{name:"voice-time",description:"Check the voice time leaderboard",type:discord_js_1.ApplicationCommandOptionType.Subcommand}],run:({interaction:e,client:s})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const i=e.options.getSubcommand();if("messages"===i){const i=yield(0,querys_1.users)().profile().find({guildId:e.guildId});if(!i.length)return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("No users have ever use this server.").setColor("Red")]});const t=i.sort(((e,s)=>s.messages-e.messages)).map(((e,s)=>Object.assign(Object.assign({},e.toJSON()),{position:s+1}))),o=Math.ceil(t.length/10),l=[];for(let e=0;e<o;e++){const i=t.slice(10*e,10*(e+1)).map((e=>(0,replaceAll_1.default)(s.messages.Embeds.LeaderboardMessagesEmbed.panelsFormat,{"{position}":e.position,"{user}":`<@!${e.ownerId}>`,"{messages}":e.messages||0})));l.push((0,replaceAll_1.default)(s.messages.Embeds.LeaderboardMessagesEmbed,{"{users}":i.join("\n"),"{current-page}":l.length+1,"{total-pages}":o}))}(0,pagination_1.default)({interaction:e,embeds:l,time:12e4})}if("invites"===i){const i=(yield InvitesModel_1.default.find({guildId:e.guildId})).sort(((e,s)=>{var i,t;return(null===(i=s.invites)||void 0===i?void 0:i.length)-(null===(t=e.invites)||void 0===t?void 0:t.length)})).map(((e,s)=>Object.assign(Object.assign({},e),{position:s+1}))),t=Math.ceil((null==i?void 0:i.length)/10),o=[];for(let e=0;e<t;e++){const l=i.slice(10*e,10*(e+1)).map((({userId:e,join:i,left:t,fake:o,bonus:l,invites:a},n)=>(0,replaceAll_1.default)(s.messages.Embeds.LeaderboardInvitesEmbed.panelsFormat,{"{position}":n+1,"{user}":`<@!${e||s.user.id}>`,"{total}":(null==a?void 0:a.length)+l,"{join}":null==i?void 0:i.length,"{left}":null==t?void 0:t.length,"{fake}":null==o?void 0:o.length,"{bonus}":l})));o.push((0,replaceAll_1.default)(s.messages.Embeds.LeaderboardInvitesEmbed,{"{users}":l.join("\n"),"{current-page}":o.length+1,"{total-pages}":t}))}(0,pagination_1.default)({interaction:e,embeds:o,time:3e4})}if("levels"===i){const i=yield(0,querys_1.users)().profile().find({guildId:e.guildId});if(!i.length)return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("No users have ever use this server.").setColor("Red")]});const t=i.sort(((e,s)=>s.xp-e.xp)),o=Math.ceil(t.length/10),l=[];for(let e=0;e<o;e++){const i=t.slice(10*e,10*(e+1)).map(((e,i)=>(0,replaceAll_1.default)(s.messages.Embeds.LeaderboardLevelsEmbed.panelsFormat,{"{position}":i+1,"{user}":`<@!${e.ownerId}>`,"{level}":e.level,"{xp}":e.xp})));l.push((0,replaceAll_1.default)(s.messages.Embeds.LeaderboardLevelsEmbed,{"{users}":i.join("\n"),"{current-page}":l.length+1,"{total-pages}":o}))}(0,pagination_1.default)({interaction:e,embeds:l,time:12e4})}if("economy"===i){const i=yield(0,querys_1.users)().economy().getAll(e.guildId),t=yield(0,querys_1.guilds)().get(e.guildId);if(!i.length)return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("No users have ever use this server.").setColor("Red")]});const o=i.sort(((e,s)=>s.balance.money+s.balance.bank-(e.balance.money+e.balance.bank))).map((({userId:e,balance:s},i)=>Object.assign({userId:e,balance:s},{position:i+1}))),l=Math.ceil(o.length/10),a=[];for(let e=0;e<l;e++){const i=o.slice(10*e,10*(e+1)).map((e=>{var i;return(0,replaceAll_1.default)(s.messages.Embeds.LeaderboardEconomyEmbed.panelsFormat,{"{position}":e.position,"{user}":`<@!${e.userId}>`,"{total}":e.balance.money+e.balance.bank,"{cash}":e.balance.money,"{bank}":e.balance.bank,"{coin}":(null===(i=null==t?void 0:t.economyConfig)||void 0===i?void 0:i.coin)||"ðŸª™"})}));a.push((0,replaceAll_1.default)(s.messages.Embeds.LeaderboardEconomyEmbed,{"{users}":i.join("\n"),"{current-page}":a.length+1,"{total-pages}":l}))}(0,pagination_1.default)({interaction:e,embeds:a,time:12e4})}if("voice-time"===i){const i=yield(0,querys_1.users)().profile().find({guildId:e.guildId});if(!i.length)return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("No users have ever use this server.").setColor("Red")]});const t=i.sort(((e,s)=>s.voiceTime-e.voiceTime)).filter((({voiceTime:e})=>e)),o=Math.ceil(t.length/10),l=[];for(let e=0;e<o;e++){const i=t.slice(10*e,10*(e+1)).map(((e,i)=>(0,replaceAll_1.default)(s.messages.Embeds.LeaderboardVoiceTimeEmbed.panelsFormat,{"{position}":i+1,"{user}":`<@!${e.ownerId}>`,"{time}":(0,ms_1.default)(e.voiceTime,{long:!0})})));l.push((0,replaceAll_1.default)(s.messages.Embeds.LeaderboardVoiceTimeEmbed,{"{users}":i.join("\n"),"{current-page}":l.length+1,"{total-pages}":o}))}(0,pagination_1.default)({interaction:e,embeds:l,time:12e4})}}))});