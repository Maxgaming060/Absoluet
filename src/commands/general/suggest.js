"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),SuggestModel_1=tslib_1.__importDefault(require("../../models/SuggestModel")),Command_1=require("../../structures/Command"),parseStyle_1=tslib_1.__importDefault(require("../../helpers/parseStyle")),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),querys_1=require("../../helpers/querys");exports.default=new Command_1.Command({name:"suggest",description:"Send a suggestion to the staff team",options:[{name:"query",description:"Your suggestion",type:discord_js_1.ApplicationCommandOptionType.String,required:!0}],run:({interaction:e,client:s})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var t;const o=e.options.getString("query"),i=yield(0,querys_1.guilds)().get(e.guildId);if(!(null===(t=null==i?void 0:i.suggestionConfig)||void 0===t?void 0:t.channel))return e.reply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Configure the suggestion channel using -/setup").setColor(s.config.GeneralSettings.EmbedColor)]});const n=i.suggestionConfig,d=e.guild.channels.cache.get(n.channel),u=yield d.send({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Loading suggestion....").setColor("Orange")]});yield u.edit({embeds:[(0,replaceAll_1.default)(s.messages.Embeds.SuggestPendingEmbed,{"{updated-date}":(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),"{suggestion}":o,"{upvote-emoji}":(null==n?void 0:n.upvote)||"üëç","{downvote-emoji}":(null==n?void 0:n.downvote)||"üëé","{upvote-count}":1,"{downvote-count}":1,"{user-tag}":e.user.tag,"{user-pfp}":e.user.displayAvatarURL(),"{message-id}":u.id})],components:[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.ButtonBuilder).setLabel(s.messages.Buttons.SuggestUpvote.Label).setEmoji(s.messages.Buttons.SuggestUpvote.Emoji.replace("{upvote-emoji}",null==n?void 0:n.upvote)||"üëç").setStyle((0,parseStyle_1.default)(s.messages.Buttons.SuggestUpvote.Style)).setCustomId(`sgt-upvote-${u.id}`),(new discord_js_1.ButtonBuilder).setLabel(s.messages.Buttons.SuggestDownvote.Label).setEmoji(s.messages.Buttons.SuggestDownvote.Emoji.replace("{downvote-emoji}",null==n?void 0:n.downvote)||"üëé").setStyle((0,parseStyle_1.default)(s.messages.Buttons.SuggestDownvote.Style)).setCustomId(`sgt-downvote-${u.id}`),(new discord_js_1.ButtonBuilder).setLabel(s.messages.Buttons.SuggestReset.Label).setEmoji(s.messages.Buttons.SuggestReset.Emoji).setStyle((0,parseStyle_1.default)(s.messages.Buttons.SuggestReset.Style)).setCustomId(`sgt-reset-${u.id}`))]}),yield e.reply({embeds:[(0,replaceAll_1.default)(s.messages.Embeds.SuggestSentEmbed)]});const l=new SuggestModel_1.default({date:new Date,downvotes:[s.user.id],guildId:e.guildId,ownerId:e.user.id,staffResponse:null,staffUsername:null,suggestion:o,suggestionId:u.id,upvotes:[s.user.id],status:"Pending"});yield l.save()}))});