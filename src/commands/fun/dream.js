"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),axios_1=tslib_1.__importDefault(require("axios")),API_URL="https://paint.api.wombo.ai/api/v2/tasks/",STYLES=[{name:"Buliojourney v2",value:84},{name:"Realistic v2",value:78},{name:"Spectral v2",value:92},{name:"Flora v2",value:81},{name:"Watercolor v2",value:91},{name:"Blues v2",value:88},{name:"Unrealistic v2",value:89},{name:"VFX v2",value:79},{name:"Expressionism",value:77},{name:"Figure",value:76},{name:"HDR",value:52},{name:"Spectral",value:63},{name:"Comic",value:45},{name:"Soft Touch",value:71},{name:"Splatter",value:74},{name:"Festive",value:73},{name:"Winter",value:72},{name:"Realistic",value:32},{name:"Flora",value:68},{name:"Diorama",value:65},{name:"Abstract",value:67},{name:"Fantastical",value:61},{name:"Vector",value:60},{name:"Cartoonist",value:58},{name:"Bad Trip",value:57}];exports.default=new Command_1.Command({name:"dream",description:"Generate images using AI",options:[{name:"prompt",description:"The prompt of the image to generate",type:discord_js_1.ApplicationCommandOptionType.String,required:!0},{name:"style",description:"The style of the image to generate",type:discord_js_1.ApplicationCommandOptionType.Integer,choices:STYLES.map((e=>e)),required:!0}],run:({interaction:e,client:t})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const a=e.options.getString("prompt"),i=e.options.getInteger("style");yield e.deferReply();try{const o=yield generateImage(i,a);if(null==o?void 0:o.is_nsfw)return e.followUp({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Please don't use those kind of prompts, be respectful").setColor("Red")]});const r=new discord_js_1.AttachmentBuilder(o.result.final,{name:"image.png"});e.followUp({embeds:[(0,replaceAll_1.default)(t.messages.Embeds.DreamGeneratedEmbed,{"{prompt}":a,"{style}":i.toString()})],files:[r]})}catch(t){console.error(t),e.followUp({embeds:[(new discord_js_1.EmbedBuilder).setTitle("There was an error generating your image, try again").setColor("Red")]})}}))});const signUp=()=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((e=>{axios_1.default.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=AIzaSyDCvp5MTJLUdtBYEKYWXJrlLzu1zuKM6Xw",{}).then((function(t){e(t.data)})).catch((function(t){console.log("error"),e(t)}))}))})),createTask=(e,t,a)=>{const i={input_spec:{display_freq:10,prompt:t,style:a},is_premium:!1};return new Promise(((t,a)=>{axios_1.default.post(`${API_URL}`,i,{headers:{Origin:"https://dream.ai",Referer:"https://dream.ai/",Authorization:"bearer "+e,"Content-Type":"text/plain;charset=UTF-8"}}).then((function(e){var a;t(null===(a=e.data)||void 0===a?void 0:a.id)})).catch((function(e){a(e)}))}))},checkStatus=(e,t)=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(((a,i)=>{axios_1.default.get(API_URL+t,{headers:{Origin:"https://dream.ai",Referer:"https://dream.ai/",Authorization:"bearer "+e,"Content-Type":"text/plain;charset=UTF-8"}}).then((function(i){return tslib_1.__awaiter(this,void 0,void 0,(function*(){let o=i.data;for(;"completed"!=o.state&&"failed"!=o.state;){try{o=(yield axios_1.default.get(API_URL+t,{headers:{Origin:"https://app.wombo.art",Referer:"https://app.wombo.art/",Authorization:"bearer "+e,"Content-Type":"text/plain;charset=UTF-8"}})).data}catch(e){a(e)}yield new Promise((e=>setTimeout(e,5e3)))}a(o)}))})).catch((function(e){i(e)}))}))})),generateImage=(e,t)=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){var a;const i=null===(a=yield tslib_1.__awaiter(void 0,void 0,void 0,(function*(){return new Promise((e=>{axios_1.default.post("https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=AIzaSyDCvp5MTJLUdtBYEKYWXJrlLzu1zuKM6Xw",{}).then((function(t){e(t.data)})).catch((function(t){console.log("error"),e(t)}))}))})))||void 0===a?void 0:a.idToken,o=yield createTask(i,t,e);return yield checkStatus(i,o)}));