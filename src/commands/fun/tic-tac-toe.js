"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),messageUtils_1=require("../../helpers/messageUtils"),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),playersEmojis=["âž–","<:multiply:1128911651857518612>","<:circle:1128911517451026473>"];function generateComponentsFromBoard(e,t=!1){const o=o=>(new discord_js_1.ButtonBuilder).setDisabled(t||0!==e[o]).setEmoji((t=>0===e[t]?"âž–":1===e[t]?playersEmojis[1]:playersEmojis[2])(o)).setStyle(0===e[o]?2:1===e[o]?4:1).setCustomId(`tc-${o}`);return[(new discord_js_1.ActionRowBuilder).addComponents(o(0),o(1),o(2)),(new discord_js_1.ActionRowBuilder).addComponents(o(3),o(4),o(5)),(new discord_js_1.ActionRowBuilder).addComponents(o(6),o(7),o(8))]}function checkWinner(e){const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const o of t){const[t,s,r]=o;if(0!==e[t]&&e[t]===e[s]&&e[t]===e[r])return e[t]}return 0}exports.default=new Command_1.Command({name:"tic-tac-toe",description:"Play a game of Tic Tac Toe with your friends",options:[{name:"user",description:"The user to play Tic Tac Toe with",type:discord_js_1.ApplicationCommandOptionType.User,required:!0}],run:({client:e,interaction:t})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const o=[e.user,t.user,t.options.getUser("user")],s=yield(0,messageUtils_1.approve)({author:t.user,game:"Tic Tac Toe",user:o[2],interaction:t});if(!s)return t.editReply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.GameRejectedEmbed,{"{user-name}":o[2].username,"{user-id}":o[2].id,"{game}":"Tic Tac Toe"})],components:[]});let r=Math.floor(2*Math.random()+1);const n=[0,0,0,0,0,0,0,0,0];yield s.deferUpdate();const i=()=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){return yield t.editReply({content:`${playersEmojis[r]} ${o[r].toString()}`,embeds:[(0,replaceAll_1.default)(e.messages.Embeds.TicTacToeTurnEmbed,{"{turn-username}":o[r].username,"{turn-id}":o[r].id,"{game}":"Tic Tac Toe"})],components:generateComponentsFromBoard(n)})})),d=(yield i()).createMessageComponentCollector({componentType:discord_js_1.ComponentType.Button,filter:t=>t.user.id===o[r].id||(t.reply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.CantInteractEmbed)],ephemeral:!0}),!1),max:9});d.on("collect",(s=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const a=parseInt(s.customId.replace("tc-",""));yield s.deferUpdate(),d.resetTimer(),n[a]=r,r=2===r?1:2;const c=checkWinner(n);if(0!==c){const s=o[c];return t.editReply({content:`ðŸŽ‰ ${s.toString()}`,embeds:[(0,replaceAll_1.default)(e.messages.Embeds.TicTacToeWinnerEmbed,{"{user-name}":s.username,"{user-id}":s.id,"{game}":"Tic Tac Toe"})],components:generateComponentsFromBoard(n,!0)}),d.stop()}if(0===n.filter((e=>0===e)).length)return t.editReply({embeds:[(0,replaceAll_1.default)(e.messages.Embeds.TicTacToeTieEmbed,{"{game}":"Tic Tac Toe"})],components:generateComponentsFromBoard(n,!0)}),d.stop();yield i()}))))}))});