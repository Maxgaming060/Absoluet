"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),discord_js_1=require("discord.js"),messageUtils_1=require("../../helpers/messageUtils"),Command_1=require("../../structures/Command");function generateComponentsBoard(e=!1){return[(new discord_js_1.ActionRowBuilder).addComponents((new discord_js_1.ButtonBuilder).setCustomId("rps-rock").setStyle(discord_js_1.ButtonStyle.Secondary).setDisabled(e).setLabel("Rock").setEmoji("🪨"),(new discord_js_1.ButtonBuilder).setCustomId("rps-paper").setStyle(discord_js_1.ButtonStyle.Secondary).setDisabled(e).setLabel("Paper").setEmoji("🧻"),(new discord_js_1.ButtonBuilder).setCustomId("rps-scissors").setStyle(discord_js_1.ButtonStyle.Secondary).setDisabled(e).setLabel("Scissors").setEmoji("✂️"))]}function determineRPSResult(e,s){return e===s?0:"rock"===e&&"scissors"===s||"paper"===e&&"rock"===s||"scissors"===e&&"paper"===s?1:2}function getRPSChoiceEmoji(e){return"rock"===e?"🪨":"paper"===e?"🧻":"scissors"===e?"✂️":"❔"}exports.default=new Command_1.Command({name:"rps",description:"Play a game of Rock Paper Scissors with your friends",options:[{name:"user",description:"The user to play Rock Paper Scissors with",type:discord_js_1.ApplicationCommandOptionType.User,required:!0}],run:({client:e,interaction:s})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const t=s.options.getUser("user"),o=yield(0,messageUtils_1.approve)({author:s.user,game:"Rock Paper Scissors",interaction:s,user:t});if(!o)return s.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle(`The game has been rejected by ${t.username}`).setColor("Red")],components:[]});const r=[null,null];yield o.deferUpdate();const i=(yield s.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Rock Paper Scissors").setDescription("Press a button below to make a choice.").setColor(e.config.GeneralSettings.EmbedColor).addFields({name:s.user.username,value:"❔",inline:!0},{name:"VS",value:"⚡",inline:!0},{name:t.username,value:"❔",inline:!0})],components:generateComponentsBoard(!1)})).createMessageComponentCollector({componentType:discord_js_1.ComponentType.Button,time:6e4});i.on("collect",(o=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){i.resetTimer();const{customId:n}=o;if(o.user.id!==s.user.id&&o.user.id!==t.id)return void o.reply({content:"❌ | You are not part of this game.",ephemeral:!0});if(r[0]&&r[1])return void o.reply({content:"❌ | Both players have already made their choices.",ephemeral:!0});let d;if(d=o.user.id===s.user.id?0:1,r[d])return void o.reply({content:"❌ | You have already made your choice.",ephemeral:!0});const a=n.split("rps-")[1];if(r[d]=a,yield o.reply({content:"Your choice has been recorded.",ephemeral:!0}),r[0]&&r[1]){const o=determineRPSResult(r[0],r[1]),n=1===o?s.user:t;return yield s.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Rock Paper Scissors").setColor(e.config.GeneralSettings.EmbedColor).setDescription(0===o?"The Game tied! No one won the Game!":`🎉 ${n.toString()} won the Game! Congratulations`).addFields({name:s.user.username,value:getRPSChoiceEmoji(r[0]),inline:!0},{name:"VS",value:"⚡",inline:!0},{name:t.username,value:getRPSChoiceEmoji(r[1]),inline:!0})],components:generateComponentsBoard(!0)}),i.stop()}s.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Rock Paper Scissors").setDescription(`${o.user.toString()} has just selected his option\n\t\t\t\t\t\t\tPress a button below to make a choice.`).setColor(e.config.GeneralSettings.EmbedColor).addFields({name:s.user.username,value:"❔",inline:!0},{name:"VS",value:"⚡",inline:!0},{name:t.username,value:"❔",inline:!0})]})})))),i.on("end",(()=>{r[0]&&r[1]||s.editReply({embeds:[(new discord_js_1.EmbedBuilder).setTitle("Rock Paper Scissors").setDescription("The game has ended due to inactivity.").setColor("Red").setFooter({text:"Both players needed to make a choice."})],components:generateComponentsBoard(!0)})}))}))});