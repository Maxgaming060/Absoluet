"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),generateWorlde_1=tslib_1.__importDefault(require("../../helpers/images/generateWorlde")),words_json_1=tslib_1.__importDefault(require("../../helpers/assets/words.json")),Command_1=require("../../structures/Command"),replaceAll_1=tslib_1.__importDefault(require("../../helpers/replaceAll")),discord_js_1=require("discord.js"),__1=require("../..");exports.default=new Command_1.Command({name:"wordle",description:"Play the wordle game",run:({interaction:e})=>tslib_1.__awaiter(void 0,void 0,void 0,(function*(){const s=new Wordle(e);yield s.startGame()}))});class Wordle{constructor(e){this.word=words_json_1.default[Math.floor(Math.random()*words_json_1.default.length)],this.message=e,this.guessed=[]}getBoardImage(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const e=yield(0,generateWorlde_1.default)(this.guessed,this.word);return new discord_js_1.AttachmentBuilder(e,{name:"wordle.png"})}))}startGame(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){yield this.message.reply({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds.WordlePendingGame,{"{user-tag}":this.message.user.tag,"{user-id}":this.message.user.id,"{user-avatar}":this.message.user.displayAvatarURL()})],files:[yield this.getBoardImage()],fetchReply:!0});const e=this.message.channel.createMessageCollector({idle:12e4,filter:e=>e.author.id===this.message.user.id&&5===e.content.length});e.on("collect",(s=>tslib_1.__awaiter(this,void 0,void 0,(function*(){const t=s.content.toLowerCase();if(s.deletable&&(yield s.delete().catch((e=>e))),this.guessed.push(...t.split("")),this.word===t||this.guessed.length>29)return e.stop();yield this.message.editReply({embeds:[(0,replaceAll_1.default)(__1.client.messages.Embeds.WordlePendingGame,{"{user-tag}":this.message.user.tag,"{user-id}":this.message.user.id,"{user-avatar}":this.message.user.displayAvatarURL()})],files:[yield this.getBoardImage()]})})))),e.on("end",((e,s)=>tslib_1.__awaiter(this,void 0,void 0,(function*(){"user"!==s&&"idle"!==s||this.gameOver()}))))}))}gameOver(){return tslib_1.__awaiter(this,void 0,void 0,(function*(){const{WordleWrongGame:e,WordleSuccesGame:s}=__1.client.messages.Embeds,t=this.guessed.slice(this.guessed.length-5).join("")===this.word;return yield this.message.editReply({embeds:[(0,replaceAll_1.default)(t?s:e,{"{user-tag}":this.message.user.tag,"{user-id}":this.message.user.id,"{user-avatar}":this.message.user.displayAvatarURL(),"{word}":this.word})],files:[yield this.getBoardImage()]})}))}}